
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab Week 9 - solution &#8212; EOSC211 - Computer Methods for Earth, Ocean, and Atmospheric Scientists</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Week 10: Interpolation - some examples" href="../../wk10/wk10_interpolation_demo.html" />
    <link rel="prev" title="Quiz Week 9: Debugging with Functions solution" href="../../wk09/quiz_wk9_soln.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">EOSC211 - Computer Methods for Earth, Ocean, and Atmospheric Scientists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../announcements.html">
   Course Home/Announcements
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 1 - Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus/syllabus.html">
   Course Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus/covid_statements.html">
   Covid Safety in the Classroom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus/schedule_F2021.html">
   Course Schedule - Fall Semester 2021
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus/worksheet_steps_in_problem_solving.html">
   Steps In Problem Solving
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 2 - Data Types
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk02/data_types.html">
   Data Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk02/some_review_plus_built_in_functions_arrays_preview.html">
   Some Review Plus Built-In Functions, Arrays Preview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2_lab/lab_wk2.html">
   Answers: Lab Week 2 - Jupyterhub Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk02/week2_quiz.html">
   Week 2 quiz
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 3 - Data Structures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk03/data_structures.html">
   Data Structures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk03/data_structures_ii.html">
   Data Structures II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk03/week3_quiz.html">
   Week 3 quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3_lab/lab_wk3_soln.html">
   Answers: Lab Week 3
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 4 - Scientific Figures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk04/making_plots.html">
   Making Plots Worksheet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4_lab/lab_wk4.html">
   Answers: Lab Week 4
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 5 - Computer Logic
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk05/logic.html">
   Logic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk05/complicated_logic.html">
   More Complicated Logic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk05/wk05_indexing.html">
   Indexing worksheet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk05/wk05_indexing_soln.html">
   Week 5 indexing solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk05/week5_quiz_sol.html">
   Week 5 quiz solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5_lab/lab_wk5.html">
   Answers: Lab Week 5
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 6 - Loops
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk06/loops.html">
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk06/loops_soln.html">
   Loops – Solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk06/loops_ii.html">
   Loops II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk06/loops_ii_soln.html">
   Loops II solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk06/week6_quiz_sol.html">
   Week 6 quiz solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6_lab/lab_wk6.html">
   Lab Week 6 Solution
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 7 - Midterm
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk07/midterm_review_sol.html">
   Midterm Review solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk07/week7_quiz_sol.html">
   Week 7 quiz solution
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 8 - Functions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk08/functions_soln.html">
   Functions – solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk08/quiz_wk08_soln.html">
   Week 08 Quiz: Functions basics -solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week8_lab/lab_wk8.html">
   Lab Week 8 - solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../midterm/midterm_2021_key.html">
   e211 2021t1 midterm solutions
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 9 - Functions/debugging
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk09/debugging.html">
   More Functions &amp; Debugging Practice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk09/debugging_soln.html">
   solution: More Functions &amp; Debugging Practice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk09/quiz_wk9_soln.html">
   Quiz Week 9:  Debugging with Functions solution
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lab Week 9 - solution
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Week 10 - Interpolation/scipy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk10/wk10_interpolation_demo.html">
   Week 10:  Interpolation - some examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../wk10/dictionaries_and_f_strings.html">
   Dictionaries, F String Literals
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Assignment 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignment1/assignment1.html">
   Assignment 1 – CO2/temperature
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Reference material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference_notes/thursday_oct7.html">
   Notes for Thursday Oct. 7
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../_sources/lab_keys/week9_lab/lab_wk9.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/lab_keys/week9_lab/lab_wk9.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phaustin/eosc211_students/e211_live_main?urlpath=tree/lab_keys/week9_lab/lab_wk9.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://eosc211.jupyterhub.eoas.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https://github.com/phaustin/eosc211_students&urlpath=tree/eosc211_students/lab_keys/week9_lab/lab_wk9.ipynb&branch=e211_live_main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#eosc-211">
   EOSC 211
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-objectives">
     Learning Objectives:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intro">
   Intro
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#your-task">
     Your Task
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-1-creating-useful-functions-tutorial">
   Part 1: Creating Useful Functions (Tutorial)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#function-style">
     Function style
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-form-of-python-function-signatures">
     General form of python function signatures
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-2-write-your-own-module-tutorial">
   Part 2: Write Your Own Module (Tutorial)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-3-apply-to-real-data-analysis">
   Part 3: Apply to Real Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objective-1-getting-oriented-with-the-task-at-hand">
     Objective 1:  Getting oriented with the task at hand.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-few-more-details-on-the-data-analysis">
       A few more details on the data analysis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objective-2-write-select-region">
     Objective 2:  write select_region()
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-your-select-region">
       Test your select_region()
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objective-3">
     Objective 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#to-hand-in">
     To Hand In
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions-for-export-in-the-next-cell">
     Functions for export in the next cell
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="lab-week-9-solution">
<h1>Lab Week 9 - solution<a class="headerlink" href="#lab-week-9-solution" title="Permalink to this headline">¶</a></h1>
<div class="section" id="eosc-211">
<h2>EOSC 211<a class="headerlink" href="#eosc-211" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-objectives">
<h3>Learning Objectives:<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Writing functions with optional arguments</p></li>
<li><p>Learn some stylish, <em>pythonic</em> tricks for writing clean, succinct functions</p></li>
<li><p>Write a large, well-organized program which implements a <em>module</em></p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/example_figure.png"><img alt="../../_images/example_figure.png" src="../../_images/example_figure.png" style="width: 60%;" /></a>
</div>
</div>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>This lab is about using functions and modules to keep code organized even when the data analysis gets large and complex. So far, we have been mostly concerned with the finer details of python syntax and the building blocks that make up the language. Learning a programming language is not that different than learning a spoken language – now that we have mastered the A,B,C’s and can put words together to form sentences, it’s time to scale up and write a bona-fide essay.</p>
<p>Sometime soon in your EOSC career, you will be asked to complete a project that requires analysis of a dataset and a subsequent report of your techniques and the conclusions you draw from your research. More often than not, the person to whom you submit your report is much more interested in the “science,” and less interested in nitty-gritty bits of code you used to get there. (They might be less well-versed in python, or maybe they don’t speak code at all!) Your analysis should therefore contain only the few lines of code needed illustrate where you got your data, the steps taken to process it, and a scientific figure which effectively communicates the final result.</p>
<p>A great way to accomplish this is to implement the majority of your code in a <em>function module</em>, a separate python program that contains the functions you created to accomplish your analysis, and a <em>main script</em> which contains your only minimalist code cells that call functions imported from your library, and to accompany this with some written exposition on the topic at hand.</p>
<div class="section" id="your-task">
<h3>Your Task<a class="headerlink" href="#your-task" title="Permalink to this headline">¶</a></h3>
<p>This week we are interested in exploring the ocean surface-currents during the summer months (averaged over May, June and July). Our raw data is in the file <code class="docutils literal notranslate"><span class="pre">mgsva_MJJ.csv</span></code>, and most of the functions are already provided to get the data, perform some analysis and generate a map of surface currents.</p>
<p>Your task is to add some additional capability, then <em>package</em> these functions in a <em>module</em>, and finally write a a <em>main script</em> that calls functions imported from your module and includes any report text / commenting needed. More generally speaking, programmers refer to these as two types of code as <em>back-end</em> (used to do stuff) and <em>front-end</em> (used for nicely presenting stuff).</p>
<p>Aside: There is a good plain English article <strong><a class="reference external" href="https://learnpython.com/blog/python-modules-packages-libraries-frameworks/">here</a></strong>  that explains the difference between modules, packages, libraries and even frameworks.</p>
<p>The easiest way to remember the heirarchy is <em>functions=paragraphs, modules=chapters, packages=books</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1">#import this # what happens if you un-comment this line?</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="part-1-creating-useful-functions-tutorial">
<h2>Part 1: Creating Useful Functions (Tutorial)<a class="headerlink" href="#part-1-creating-useful-functions-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Functions are the paragraphs of programming.  Like a good paragraph, a good function has a topic and a logical structure.  Paragraphs can be any length, but generally they are concise – about 5-6 sentences.  If they get
longer than that, the reader begins to lose the plot, and the paragraph becomes “run-on”.</p>
<div class="section" id="function-style">
<h3>Function style<a class="headerlink" href="#function-style" title="Permalink to this headline">¶</a></h3>
<p>While all rules can be broken, these are good checkpoints to keep in mind when writing a function:</p>
<ol>
<li><p>Functions should be small (usually less than 20 lines of code)</p></li>
<li><p>They should do one thing (Single Responsibility Principle)</p></li>
<li><p>Function argument lists should be limited to at most 4-5 variables</p></li>
<li><p>Function names should say what they do,and should be resemble verbs if possible
(“calc_mean”, “write_file”, “read_data”)</p></li>
<li><p>Functions should avoid “side effects”</p>
<p>An example of a side effect: modifying a variable that has been passed to a function without returning
that variable.  This kind of hidden action makes it difficult for a reader quickly determine
what a function does.</p>
</li>
</ol>
<p>Following these rules make it much easier to understand and debug a program.</p>
<p>Python has a few features that help in writing functions that are concise and easier to adapt for future use without having to rewrite old code.</p>
<ol>
<li><p><strong>Keyword arguments</strong>  <a class="reference external" href="https://phaustin.github.io/Problem-Solving-with-Python/Functions-and-Modules/Positional-and-Keyword-Arguments.html#keyword-arguments">Text Section 8.8</a></p>
<p>Optional keyword arguments.  Optional arguments can be used to keep the number of arguments passed
to a function as small as possible. If these parameters are omitted, their default values are used
instead.
In this example, we’re using slice objects discussed in the <a class="reference external" href="https://phaustin.github.io/eosc211_students/reference_notes/thursday_oct7.html">Oct. 7 notes</a>:</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">average_region</span><span class="p">(</span><span class="n">the_map</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">lat_slice</span><span class="o">.</span><span class="n">start</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">lat_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">lat_slice</span><span class="o">.</span><span class="n">step</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lon_slice</span><span class="o">.</span><span class="n">start</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon_slice</span><span class="o">.</span><span class="n">step</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mean_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">the_map</span><span class="p">[</span><span class="n">lat_slice</span><span class="p">,</span><span class="n">lon_slice</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mean_map</span>

<span class="n">avg_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_region</span><span class="p">(</span><span class="n">avg_map</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_region</span><span class="p">(</span><span class="n">avg_map</span><span class="p">,</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lat_slice.start=0, lat_slice.stop=-1, lat_slice.step=None
lon_slice.start=0, lon_slice.stop=-1, lon_slice.step=None
average_region(avg_map)=39.0

lat_slice.start=3, lat_slice.stop=7, lat_slice.step=None
lon_slice.start=0, lon_slice.stop=-1, lon_slice.step=None
average_region(avg_map,lat_slice=slice(3,7))=49.0
</pre></div>
</div>
</div>
</div>
<ol>
<li><p><strong>Keyword expansion</strong></p>
<p>Keyword expansion allows a user to call your function by passing a single dictionary with parameters, instead
of having to list each parameter in the call.  This makes it easier to keep track of specific sets
of parameters. An example:</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pacific_nw_region</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">prairie_region</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span><span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_region</span><span class="p">(</span><span class="n">avg_map</span><span class="p">,</span><span class="o">**</span><span class="n">pacific_nw_region</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_region</span><span class="p">(</span><span class="n">avg_map</span><span class="p">,</span><span class="o">**</span><span class="n">prairie_region</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lat_slice.start=2, lat_slice.stop=5, lat_slice.step=None
lon_slice.start=3, lon_slice.stop=6, lon_slice.step=None
average_region(avg_map,**pacific_nw_region)=34.0

lat_slice.start=3, lat_slice.stop=7, lat_slice.step=None
lon_slice.start=8, lon_slice.stop=9, lon_slice.step=None
average_region(avg_map,**prairie_region)=53.0
</pre></div>
</div>
</div>
</div>
<p>The keyword expansion operator <code class="docutils literal notranslate"><span class="pre">**</span></code> is called “double splat” and can also be used in a function definition to represent an unknown/arbitrary number of optional arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_args</span><span class="p">(</span><span class="o">**</span><span class="n">my_args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">my_args</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">print_args</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>my_args={&#39;a&#39;: 5, &#39;b&#39;: 7, &#39;c&#39;: 10}
</pre></div>
</div>
</div>
</div>
<ol>
<li><p><strong>Function wrappers</strong></p>
<p>You can expand a function’s signature to create a new function with extra options.  Suppose you wanted
to add a missing  value option to the <code class="docutils literal notranslate"><span class="pre">average_region</span></code> function.   You could do that by <em>wrapping</em> the
function in an outer function.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">average_missing</span><span class="p">(</span><span class="n">the_map</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">missing_val</span><span class="o">=-</span><span class="mf">999.</span><span class="p">):</span>
    <span class="n">hit</span> <span class="o">=</span> <span class="p">(</span><span class="n">the_map</span> <span class="o">==</span> <span class="n">missing_val</span><span class="p">)</span>
    <span class="n">new_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">the_map</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1">#make a copy so no side effects</span>
    <span class="n">new_map</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">average_region</span><span class="p">(</span><span class="n">new_map</span><span class="p">,</span><span class="n">lat_slice</span><span class="p">,</span><span class="n">lon_slice</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_missing</span><span class="p">(</span><span class="n">avg_map</span><span class="p">,</span><span class="o">**</span><span class="n">pacific_nw_region</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lat_slice.start=2, lat_slice.stop=5, lat_slice.step=None
lon_slice.start=3, lon_slice.stop=6, lon_slice.step=None
average_missing(avg_map,**pacific_nw_region)=34.0
</pre></div>
</div>
</div>
</div>
<ol>
<li><p><strong>Partial functions</strong> (<em>not needed in this lab but useful to know about if you do a lot more coding</em>)</p>
<p>Finally, suppose you want to slim your function arguments down by defining a new function with some of the
default arguments defined.  You can do this using <a class="reference external" href="https://www.udacity.com/blog/2020/12/how-to-create-partial-functions-in-python.html">partial functions</a>.  Here’s an example where you know you are always going to use -222 for missing data.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="n">my_average_missing</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">average_missing</span><span class="p">,</span><span class="n">missing_val</span><span class="o">=-</span><span class="mi">222</span><span class="p">)</span>

<span class="n">new_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">avg_map</span><span class="p">)</span>
<span class="n">new_map</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">=-</span><span class="mi">222</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">my_average_missing</span><span class="p">(</span><span class="n">new_map</span><span class="p">,</span><span class="o">**</span><span class="n">pacific_nw_region</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lat_slice.start=2, lat_slice.stop=5, lat_slice.step=None
lon_slice.start=3, lon_slice.stop=6, lon_slice.step=None
my_average_missing(new_map,**pacific_nw_region)=35.375
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="general-form-of-python-function-signatures">
<h3>General form of python function signatures<a class="headerlink" href="#general-form-of-python-function-signatures" title="Permalink to this headline">¶</a></h3>
<p>In the same way that you can use a dictionary expansion to represent optional parameters, you can
also use a list expansion (<code class="docutils literal notranslate"><span class="pre">*args</span></code>) to expand a required list of arguments in a function call.
Here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_vars</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">out</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">       </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">args</span><span class="si">=}</span><span class="s2"></span>
<span class="s2">       </span><span class="si">{</span><span class="n">kw</span><span class="si">=}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
<span class="n">print_vars</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">print_vars</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">print_vars</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       len(args)=3, args=(1, 2, 3)
       kw={&#39;a&#39;: 5, &#39;b&#39;: 6}
    

       len(args)=0, args=()
       kw={&#39;height&#39;: 5}
    

       len(args)=3, args=(1, 2, 3)
       kw={}
    
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="part-2-write-your-own-module-tutorial">
<h2>Part 2: Write Your Own Module (Tutorial)<a class="headerlink" href="#part-2-write-your-own-module-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Once our code has been packaged in succinct functions with no side effects, we can export it as a module and call our functions from other scripts. In the lab folder, you will find a file called <code class="docutils literal notranslate"><span class="pre">example_funcs.py</span></code>. We want to run these functions from the current notebook. To do this, use the familiar syntax to import functions from a module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">example_funcs</span>
<span class="c1"># or from example_funcs import earth</span>
<span class="c1"># or import example_funcs as ef</span>
</pre></div>
</div>
</div>
</div>
<p>and run the function with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_funcs</span><span class="o">.</span><span class="n">earth</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Harmless&#39;
</pre></div>
</div>
</div>
</div>
<p>If you wish to add to or modify functions in a module, do the following:</p>
<ol class="simple">
<li><p>From the <code class="docutils literal notranslate"><span class="pre">lab_wk9</span></code> jupyter notebook:</p></li>
</ol>
<p><strong>(a)</strong> Go to <code class="docutils literal notranslate"><span class="pre">File</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> [Open] to get the file list, then<br />
<strong>(b)</strong> tick the box next to <code class="docutils literal notranslate"><span class="pre">example_funcs.py</span></code>,
you get new actions:<br />
[Duplicate], [Rename], [Move], [Download], [View], [Edit], [Trashcan].<br />
<strong>(c)</strong>      Clicking on [edit] opens <code class="docutils literal notranslate"><span class="pre">example_funcs.py</span></code> in a simple python editor.</p>
<ol class="simple">
<li><p>Apply your changes to the <code class="docutils literal notranslate"><span class="pre">example_funcs.py</span></code> file, save them.</p></li>
<li><p>Go back to your main notebook (i.e. this notebook), restart the kernel</p></li>
</ol>
<p>(<span class="math notranslate nohighlight">\(\blacktriangleright\blacktriangleright\)</span>), re-run the <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">example_funcs</span></code> cell.</p>
<p>The changes should now be in effect for any subsequent executions of functions in the <code class="docutils literal notranslate"><span class="pre">example_funcs.py</span></code> module.</p>
<p>Try it yourself! Use steps 1-3 to modify the function <code class="docutils literal notranslate"><span class="pre">earth()</span></code> to return the string <code class="docutils literal notranslate"><span class="pre">&quot;Mostly</span> <span class="pre">harmless&quot;</span></code> instead of its current message. Make sure the changes are reflected when you run the function from inside this notebook.</p>
</div>
<div class="section" id="part-3-apply-to-real-data-analysis">
<h2>Part 3: Apply to Real Data Analysis<a class="headerlink" href="#part-3-apply-to-real-data-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objective-1-getting-oriented-with-the-task-at-hand">
<h3>Objective 1:  Getting oriented with the task at hand.<a class="headerlink" href="#objective-1-getting-oriented-with-the-task-at-hand" title="Permalink to this headline">¶</a></h3>
<p>Read through the code in the cell below Part 3.  There are several functions that will accomplish the following tasks: (1) reading and parsing the data, (2) turning the east and north components of ocean currents into 2D grids, (3) computing a 2D running mean, (4) masking out unwanted points for plotting purposes, (5) making a plot, (6) select a sub-region from a 2D grid using a function that you will write, using the function signature provided.</p>
<p>The functions will be the back-end of the lab - you can use these as written, with the exception of the select_region function which you will write.  These functions will be placed into a module, that you can call from  your main script.  You will then write a main script that will load the data, make a 2D grid, select a subregion, compute the moving average, and make a plot.</p>
<div class="section" id="a-few-more-details-on-the-data-analysis">
<h4>A few more details on the data analysis<a class="headerlink" href="#a-few-more-details-on-the-data-analysis" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">move_to_grid()</span></code>: The first step in the data analysis (after reading and parsing the data) is done by calling the function move_to_grid(). This function 2D grids of the north and east velocities from the input 1D arrays, and longitude and latitude arrays corresponding to columns and rows respectively (like the topo data in previous labs). Land locations contain NaN.</p>
<p><code class="docutils literal notranslate"><span class="pre">mean2d()</span></code>: Then, we want to smooth the data a bit. We have dealt with running mean windows in 1D (for time series). This is generalized to a 2D case, which we are implementing with the function mean2d(). For a ‘window size’ of N (again with N odd) average the points in an NxN square centered on the location of the actual data point (draw a picture for yourself to make sure you understand how this works). For example, for a window size of 3, the 9 points within a 3 ×3 square surrounding the data point are averaged together.   Make sure you understand how the averaging works near the edges of the map, or if land points occur in the averaging window.  This kind of careful and precise working through of code can save you many, many hours of time in debugging / understanding any output.</p>
</div>
</div>
<div class="section" id="objective-2-write-select-region">
<h3>Objective 2:  write select_region()<a class="headerlink" href="#objective-2-write-select-region" title="Permalink to this headline">¶</a></h3>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">select_region()</span></code>  which takes as input the full arrays produced by <code class="docutils literal notranslate"><span class="pre">move_to_grid</span></code> and outputs only data within a row/column slice specified in the function arguments. Note how we used the
slice object in Part 1. Your function should tick all the boxes from <strong>Part 1</strong> i.e.
less than 5 required input args (or use keyword expansion), no <em>side effects</em>, etc.  We will be using slice objects as discussed  in Part 1 above.</p>
<p>Now write your select_region function. It should have a basic structure that looks like this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_region</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_vel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_vel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">),</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">):</span> 
   <span class="c1">#</span>
   <span class="c1">#  return, lons[lon_slice], lats[lat_slice] etc.</span>
   <span class="c1">#             </span>
   <span class="n">do</span><span class="p">:</span> <span class="nb">slice</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u_vel</span> <span class="ow">and</span> <span class="n">v_vel</span> <span class="n">using</span> <span class="n">lon_slice</span> <span class="ow">and</span> <span class="n">lat_slice</span>                 
<span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u_vel</span><span class="p">,</span><span class="n">v_vel</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select_region function solution</span>
<span class="c1"># Define your select_region function in this cell using the signature in the cell above</span>
<span class="c1"># </span>

<span class="c1">### BEGIN SOLUTION</span>
<span class="k">def</span> <span class="nf">select_region</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_vel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_vel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">),</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write your sel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lats</span><span class="o">=</span><span class="n">lats</span><span class="p">[</span><span class="n">lat_slice</span><span class="p">]</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">lon_slice</span><span class="p">]</span>
    <span class="n">u_vel</span><span class="o">=</span><span class="n">u_vel</span><span class="p">[</span><span class="n">lat_slice</span><span class="p">,</span><span class="n">lon_slice</span><span class="p">]</span>
    <span class="n">v_vel</span> <span class="o">=</span> <span class="n">v_vel</span><span class="p">[</span><span class="n">lat_slice</span><span class="p">,</span><span class="n">lon_slice</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u_vel</span><span class="p">,</span><span class="n">v_vel</span>
<span class="c1">### END SOLUTION</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-your-select-region">
<h4>Test your select_region()<a class="headerlink" href="#test-your-select-region" title="Permalink to this headline">¶</a></h4>
<p>Run the code in the cell below to test your <code class="docutils literal notranslate"><span class="pre">select_region()</span></code> function.  It should produce the following output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">test_lons</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="mi">36</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">test_lats</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,)</span>
<span class="n">lon1</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">])</span>
<span class="n">lat1</span><span class="o">=</span><span class="n">array</span><span class="p">([</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">u1</span><span class="o">=</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="mf">0.17101007</span><span class="p">,</span> <span class="mf">0.11697778</span><span class="p">,</span> <span class="mf">0.05939117</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.3213938</span> <span class="p">,</span> <span class="mf">0.21984631</span><span class="p">,</span> <span class="mf">0.1116189</span> <span class="p">]])</span>
<span class="n">v1</span><span class="o">=</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span>       <span class="p">,</span> <span class="mf">0.34202014</span><span class="p">,</span> <span class="mf">0.17364818</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.5</span>       <span class="p">,</span> <span class="mf">0.34202014</span><span class="p">,</span> <span class="mf">0.17364818</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.5</span>       <span class="p">,</span> <span class="mf">0.34202014</span><span class="p">,</span> <span class="mf">0.17364818</span><span class="p">]])</span>
</pre></div>
</div>
<p>Note that in Part 3  you will use the more sophisticated dictionary approach for the input arguments for <code class="docutils literal notranslate"><span class="pre">select_region</span></code>, but the example below should make it obvious what is needed later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># select region test -- this should run successfully</span>
<span class="c1">#</span>

<span class="n">test_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">test_lons</span><span class="p">)</span><span class="si">=}</span><span class="s2">,</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">test_lats</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">test_lons</span><span class="p">,</span><span class="n">test_lats</span><span class="p">)</span>
<span class="n">test_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">my</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">mx</span><span class="p">))</span>
<span class="n">test_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">mx</span><span class="p">))</span>
<span class="c1">#plt.contourf(test_lons, test_lats, test_u) # uncomment if you want to see what test_u looks like</span>

<span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">select_region</span><span class="p">(</span><span class="n">test_lons</span><span class="p">,</span> <span class="n">test_lats</span><span class="p">,</span> <span class="n">test_u</span><span class="p">,</span> <span class="n">test_v</span><span class="p">,</span>
                 <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lon1</span><span class="si">=}</span><span class="se">\n</span><span class="si">{</span><span class="n">lat1</span><span class="si">=}</span><span class="se">\n</span><span class="si">{</span><span class="n">u1</span><span class="si">=}</span><span class="se">\n</span><span class="si">{</span><span class="n">v1</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.shape(test_lons)=(36,),np.shape(test_lats)=(19,)
lon1=array([60, 70, 80])
lat1=array([ 0, 10, 20])
u1=array([[0.        , 0.        , 0.        ],
       [0.17101007, 0.11697778, 0.05939117],
       [0.3213938 , 0.21984631, 0.1116189 ]])
v1=array([[0.5       , 0.34202014, 0.17364818],
       [0.5       , 0.34202014, 0.17364818],
       [0.5       , 0.34202014, 0.17364818]])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="objective-3">
<h3>Objective 3<a class="headerlink" href="#objective-3" title="Permalink to this headline">¶</a></h3>
<p>Once you have tested your <code class="docutils literal notranslate"><span class="pre">select_region()</span></code> function, export all the functions in the cell below labeled <strong>functions for export</strong> to a module called <code class="docutils literal notranslate"><span class="pre">lab9_funcs.py</span></code>, save it in the same folder as the lab and delete the cell with these functions from this lab notebook (<strong>make a copy of this notebook first for backup</strong>).</p>
<p>In the lab notebook (this notebook), import your module and write one more function called <code class="docutils literal notranslate"><span class="pre">main()</span></code> which uses the module to generate a map of averaged ocean currents in a selected lat, lon region.  <code class="docutils literal notranslate"><span class="pre">main()</span></code> should take 4 arguments which specify the lat/lon range to map (or a single dictionary containing 4 keys) and contain liberal amounts of commenting, explaining what is happening in each step.  To reiterate, <code class="docutils literal notranslate"><span class="pre">main</span></code> is in <strong>this</strong> notebook, not the functions module.</p>
<p>When you are finished, this notebook should contain &lt; 20 lines of code (not including the tutorials above). This is the style of notebook we prefer for big projects, with minimal code which shows each step of the analysis but without displaying all the messy details.</p>
<p>Finally, write two or three sentences max summarizing your results. <strong>For the world map:</strong> Are there any noticeable patterns in the summertime surface ocean currents? Where is the fastest current in the dataset and in which direction? <strong>For your selected region</strong> Where are the min and max currents and in which directions (if the min current is close to zero you might not be able to see the direction easily)?</p>
</div>
<div class="section" id="to-hand-in">
<h3>To Hand In<a class="headerlink" href="#to-hand-in" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This notebook, with your <code class="docutils literal notranslate"><span class="pre">main()</span></code> function and the map it produces, along with your analysis (patterns, fastest current)</p></li>
<li><p>Your module <code class="docutils literal notranslate"><span class="pre">lab9_funcs.py</span></code>, which includes your <code class="docutils literal notranslate"><span class="pre">select_region()</span></code> function</p></li>
</ul>
<p>To submit multiple files to the same assignment in Canvas, see <a class="reference external" href="https://unthsc-canvas.freshdesk.com/support/solutions/articles/44001929195-how-do-i-submit-multiple-documents-to-an-assignment-">this link</a></p>
<p><strong>Hints:</strong></p>
<ol class="simple">
<li><p>My solution called the functions in the following order:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">get_data_dict</span><span class="p">(</span><span class="s2">&quot;mgsva_MJJ.csv&quot;</span><span class="p">)</span>
    <span class="n">move_to_grid</span><span class="p">(</span><span class="o">**</span><span class="n">var_dict</span><span class="p">)</span>
    <span class="n">bounds_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span><span class="n">u_vel</span><span class="o">=</span><span class="n">u</span><span class="p">,</span><span class="n">v_vel</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="c1"># find start and stop for lon_slice given min_lon and max_lon (you need to write this code snippet)</span>
    <span class="n">bounds_dict</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">)</span>
    <span class="c1"># find start and stop for lat_slice given min_lat and max_lat (you need to write this code snippet)</span>
    <span class="n">bounds_dict</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">)</span>
    <span class="n">select_region</span><span class="p">(</span><span class="o">**</span><span class="n">bounds_dict</span><span class="p">)</span>
    <span class="n">mean2d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">mean2d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">mean2d</span><span class="p">(</span><span class="n">get_magnitudes</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">mask_nth</span><span class="p">(</span><span class="n">u_filt</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">mask_nth</span><span class="p">(</span><span class="n">v_filt</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">do_plot</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">m_filt</span><span class="p">,</span> <span class="n">u_masked</span><span class="p">,</span> <span class="n">v_masked</span><span class="p">)</span>
</pre></div>
</div>
<ol class="simple">
<li><p>First make sure your code works by plotting the map for the whole world.  It should look like the one at the top of this notebook.</p></li>
<li><p>To do the array slicing you will need to find the indices of the rows and columns corresponding to the lat,lon limits for your chosen region.  <code class="docutils literal notranslate"><span class="pre">numpy.argwhere()</span></code> accomplishes this task.</p></li>
</ol>
</div>
<div class="section" id="functions-for-export-in-the-next-cell">
<h3>Functions for export in the next cell<a class="headerlink" href="#functions-for-export-in-the-next-cell" title="Permalink to this headline">¶</a></h3>
<p>– copy all the python code to <code class="docutils literal notranslate"><span class="pre">lab9_funs.py</span></code> (skip the quote marks at the very top and bottom of
that tell Jupyter to format this as a python code block)
Don’t forget to include your own version
of <code class="docutils literal notranslate"><span class="pre">select_region</span></code> in place of the stub file at the end of the cell</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">get_data_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes in &quot;filename&quot; (csv file) and outputs a dictionary containing</span>
<span class="sd">    keys:</span>

<span class="sd">         &quot;lats&quot;  - lattitude of each point</span>
<span class="sd">         &quot;lons&quot;  - longitude of each point</span>
<span class="sd">         &quot;u_vel&quot; - eastward velocity component</span>
<span class="sd">         &quot;v_vel&quot; - northward velocity component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">the_file</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="c1"># extract variables from the csv</span>
    <span class="c1"># (namespaces are a honking great idea)</span>
    <span class="n">var_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;lats&quot;</span><span class="p">:</span> <span class="n">the_file</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;lons&quot;</span><span class="p">:</span> <span class="n">the_file</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;u_vel&quot;</span><span class="p">:</span> <span class="n">the_file</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;v_vel&quot;</span><span class="p">:</span> <span class="n">the_file</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="c1"># extra information we dont need right now</span>
    <span class="c1"># &quot;u_dev&quot;:the_file[:,5],</span>
    <span class="c1"># &quot;v_dev&quot;:the_file[:,6]}</span>
    <span class="k">return</span> <span class="n">var_dict</span>


<span class="k">def</span> <span class="nf">move_to_grid</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">u_vel</span><span class="p">,</span> <span class="n">v_vel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    function to create 2D numpy arrays out of FORTRAN formatted csv data</span>

<span class="sd">    function to create 2D arrays out of FORTRAN formatted csv data.  </span>
<span class="sd">    Assumes user wants a 1 deg by 1 deg grid.</span>

<span class="sd">    in:</span>
<span class="sd">    csv file with columns 15000., lon, lat, u_vel, v_vel, u_dev, v_dev</span>

<span class="sd">    (dev is the standard deviation of each velocity measurement, 15000.</span>
<span class="sd">    is an artifact from FORTRAN formatting)</span>

<span class="sd">    out:</span>
<span class="sd">    1D arrays: lat_0, lon_0</span>
<span class="sd">    2D arrays: u, v</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set up grids</span>
    <span class="c1"># initializing with NaNs also automatically deals with points where there is</span>
    <span class="c1"># no data (eg. on land) because those locations will simply contain NaNs</span>

    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">179</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">lat_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">89</span><span class="p">,</span> <span class="mi">89</span><span class="p">)</span>
    
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">179</span><span class="p">,</span> <span class="mi">181</span><span class="p">)</span>
    <span class="n">lat_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">89</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>   <span class="c1"># CJ modified to 90 so goes -89 to 89</span>
    
    <span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_0</span><span class="p">)</span>            <span class="c1"># CJ added these two lines to reduce hardwiring.</span>
    <span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_0</span><span class="p">)</span>
    
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Loop through all points in .csv file.</span>
    <span class="c1">#</span>
    <span class="c1"># For each, calculate the row/col indices</span>
    <span class="c1"># from the lat/longs.  Lats get converted</span>
    <span class="c1"># into row indices &#39;i&#39;, and longs into column</span>
    <span class="c1"># indices &#39;j&#39;. Since we have a 1 degree spacing</span>
    <span class="c1"># we just have to add the right offset</span>
    <span class="c1"># to make this work - for example, for latitudes</span>
    <span class="c1"># latitude of -89 goes to row 0,</span>
    <span class="c1"># latitude of -88 goes to row 1, etc.</span>
    <span class="c1">#</span>
    <span class="c1"># Then write the</span>
    <span class="c1"># corresponding U/V data for that lat/long</span>
    <span class="c1"># into the right place (i.e. index (i,j) )</span>
    <span class="c1"># in the U/V matrices</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>      <span class="c1"># CJ changed from len(lats0) &lt;-- was a bug</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mi">78</span>  <span class="c1"># row index</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mi">179</span>  <span class="c1"># column index</span>
        <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_vel</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_vel</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>


<span class="k">def</span> <span class="nf">mean2d</span><span class="p">(</span><span class="n">in_map</span><span class="p">,</span> <span class="n">winlen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a 2D running mean of an input np array</span>

<span class="sd">    in:  winlen -- window length</span>
<span class="sd">         in_map -- numpy array on which to perform the running mean.</span>

<span class="sd">    assumes in_map is a world map, and wraps longitude[-1] around to [0]</span>

<span class="sd">    out: out_map -- the filtered map</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">do_mean</span><span class="p">(</span><span class="n">in_map</span><span class="p">,</span> <span class="n">winlen</span><span class="p">):</span>
        <span class="c1"># initialize output array and internal variables</span>
        <span class="n">out_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">in_map</span><span class="p">)</span>
        <span class="n">out_map</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">in_map</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">wn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">winlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># loop through every point (i, j) in the grid:</span>
        <span class="c1"># (ignore edges for now)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wn</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">-</span> <span class="n">wn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wn</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">-</span> <span class="n">wn</span><span class="p">):</span>
                <span class="c1"># don&#39;t filter points containing nan (ie land, edge of map)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">in_map</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]):</span>
                    <span class="n">out_map</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># create the window</span>
                    <span class="n">imin</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">wn</span>
                    <span class="n">imax</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">wn</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">jmin</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="n">wn</span>
                    <span class="n">jmax</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">wn</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="n">the_window</span> <span class="o">=</span> <span class="n">in_map</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">:</span><span class="n">jmax</span><span class="p">]</span>
                    <span class="c1"># use nanmean to take the mean, ignoring nan values</span>
                    <span class="n">out_map</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">the_window</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out_map</span>

    <span class="c1"># check for odd winlen</span>
    <span class="n">winlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">winlen</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">winlen</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">winlen</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">do_mean</span><span class="p">(</span><span class="n">in_map</span><span class="p">,</span> <span class="n">winlen</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mask_nth</span><span class="p">(</span><span class="n">in_map</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decimates a 2d array with all values using every n-th</span>
<span class="sd">    value, and setting all empty grid cells to NaNs.</span>
<span class="sd">    in:</span>
<span class="sd">        in_map: 2d numpy array</span>
<span class="sd">        n: desired spacing of points</span>

<span class="sd">    out:</span>
<span class="sd">        masked_map: 2d numpy array with mask applied</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">masked_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">in_map</span><span class="p">)</span>
    <span class="n">masked_map</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">masked_map</span><span class="p">[::</span><span class="n">n</span><span class="p">,</span> <span class="p">::</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_map</span><span class="p">[::</span><span class="n">n</span><span class="p">,</span> <span class="p">::</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">masked_map</span>


<span class="k">def</span> <span class="nf">get_magnitudes</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    takes in velocity components &#39;u&#39; (int or float, array-like containing int or float)</span>
<span class="sd">    and &#39;v&#39; (int or float, array-like containing int or float) and returns velocity magnitude</span>

<span class="sd">    m = (u^2 + v^2) ^ 0.5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>


<span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">m_filt</span><span class="p">,</span> <span class="n">u_masked</span><span class="p">,</span> <span class="n">v_masked</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a plot of an input velocity field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">vals</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">m_filt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;BuGn&quot;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">label</span><span class="o">=</span><span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;speed (m/s)&quot;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u_masked</span><span class="p">,</span> <span class="n">v_masked</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Summertime Surface Ocean Currents&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">select_region</span><span class="p">():</span>
    <span class="n">your</span> <span class="n">function</span> <span class="n">here</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># HAND IN</span>

<span class="c1"># In this cell a main function that calls your functions and plots</span>
<span class="c1"># a map of the surface currents.  </span>

<span class="c1"># your main routine needs to have the following name and signature</span>
<span class="c1"># main(lon_min,lon_max,lat_min,lat_max)</span>

<span class="c1"># We will call main twice:</span>
<span class="c1"># once to plot the entire world (like the figure at the to of the page) </span>
<span class="c1"># and a second time to plot an arbitray slice</span>


<span class="c1"># Note that I shorten lab9_funcs to l9fun so I can write</span>
<span class="c1"># l9fun.move_to_grid, l9fun.get_data_dict etc.</span>


<span class="kn">import</span> <span class="nn">lab9_funcs</span> <span class="k">as</span> <span class="nn">l9fun</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">### BEGIN SOLUTION</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span><span class="n">lon_max</span><span class="p">,</span><span class="n">lat_min</span><span class="p">,</span><span class="n">lat_max</span><span class="p">):</span>
    <span class="c1"># get the datafile</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;mgsva_MJJ.csv&#39;</span>

    <span class="c1"># extract variables from the csv</span>
    <span class="n">var_dict</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">get_data_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">move_to_grid</span><span class="p">(</span><span class="o">**</span><span class="n">var_dict</span><span class="p">)</span>  <span class="c1"># the honking great way</span>
    
    <span class="c1"># need to find rows,cols for slicing given lat, lons</span>
    <span class="c1"># we haven&#39;t actually shown them how to do this?</span>
    
    <span class="c1"># set up bounds for selected region</span>
    <span class="n">bounds_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span><span class="n">u_vel</span><span class="o">=</span><span class="n">u</span><span class="p">,</span><span class="n">v_vel</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="c1"># set up bounds for select region</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lons</span><span class="o">&gt;=</span><span class="n">lon_min</span><span class="p">))</span> 
    <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lons</span><span class="o">&lt;=</span><span class="n">lon_max</span><span class="p">))</span>
    <span class="n">i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lats</span><span class="o">&gt;=</span><span class="n">lat_min</span><span class="p">))</span> 
    <span class="n">i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lons</span><span class="o">&lt;=</span><span class="n">lat_max</span><span class="p">))</span>
    <span class="n">bounds_dict</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span>
    <span class="n">bounds_dict</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">i3</span><span class="p">,</span><span class="n">i4</span><span class="p">)</span>

    <span class="c1"># grab selected region</span>
    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">select_region</span><span class="p">(</span><span class="o">**</span><span class="n">bounds_dict</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># filter the velocity fields</span>
    <span class="n">filter_width</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">u_filt</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">mean2d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">v_filt</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">mean2d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">m_filt</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">mean2d</span><span class="p">(</span><span class="n">l9fun</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">filter_width</span><span class="p">)</span>

    <span class="c1"># apply mask to make nicely spaced arrows</span>
    <span class="n">u_masked</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">mask_nth</span><span class="p">(</span><span class="n">u_filt</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>
    <span class="n">v_masked</span> <span class="o">=</span> <span class="n">l9fun</span><span class="o">.</span><span class="n">mask_nth</span><span class="p">(</span><span class="n">v_filt</span><span class="p">,</span> <span class="n">filter_width</span><span class="p">)</span>

    <span class="c1"># do the plot</span>
    <span class="n">l9fun</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">m_filt</span><span class="p">,</span> <span class="n">u_masked</span><span class="p">,</span> <span class="n">v_masked</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="kc">None</span>
<span class="c1">### END SOLUTION</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># hidden calls to main() here</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="n">main</span><span class="p">(</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">main</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100,) (179,) (179, 100) (179, 100)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(359,) (179,) (179, 359) (179, 359)
</pre></div>
</div>
<img alt="../../_images/lab_wk9_34_2.png" src="../../_images/lab_wk9_34_2.png" />
<img alt="../../_images/lab_wk9_34_3.png" src="../../_images/lab_wk9_34_3.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lab_keys/week9_lab"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../../wk09/quiz_wk9_soln.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Quiz Week 9:  Debugging with Functions solution</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../../wk10/wk10_interpolation_demo.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Week 10:  Interpolation - some examples</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By UBC<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>